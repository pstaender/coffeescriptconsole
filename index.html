<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>coffeescript console</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="css/csc.css" />
  <script type="text/javascript" src="javascripts/lib/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/lib/coffee-script.js"></script>
  <script type="text/javascript" src="javascripts/lib/store.min.js"></script>
  <script type="text/javascript" src="javascripts/json2html.js"></script>
  <script type="text/javascript" src="javascripts/csc.js"></script>
  <script type="text/javascript">
  var usage = function() {
    var s = '# CoffeeScriptConsole\n\n';
    s += '  * press `shift+enter` to insert new line(s)\n';
    s += '  * press `keyup`/`keydown` to browse through history\n';
    s += '  * use `echo()` instead of `console.log()` to echo\n';
    s += '  * `clearHistory()` clears console history\n';
    s += '  * `clear()` clears screen\n';
    s += '  * `echoEvalOutput(true|false)` echo result of executed code\n\n';
    s += '## Keyboard Shortcuts\n';
    s += '  * `cmd+k` clear output screen\n';
    s += '  * `cmd+shift+k` toggle echo eval output';
    return s;
  }

  $(window).ready(function(){
    var csc = new CoffeeScriptConsole({
      $input: $('#consoleInput'),
      $output: $('#consoleOutput'),
      suggestions: 'usage(),clearHistory(),clearScreen(),echoEvalOutput(true),echo,clear()'.split(',')
    });
    window.puts = window.echo = function(output) {
      csc.echo(output);
    };
    window.clearHistory = function() {
      csc.clearHistory();
    }
    window.clear = function() {
      window.clearScreen();
      csc.clearOutputHistory();
    }

    window.clearScreen = function() {
      csc.$output.html('');
    }

    window.echoEvalOutput = function(trueOrFalse) {
      if (typeof trueOrFalse === 'boolean') {
        csc.echoEvalOutput = trueOrFalse;
        if (store)
          store.set('echoEvalOutput', trueOrFalse);
      }
    }

    window.load = function(url, cb) {
      return $.getScript(url, cb);
    }

    $(document).on('keydown', function(e) {
      // cmd + k, clear console
      if ((e.keyCode === 75 && e.metaKey) || (e.keyCode === 75 && e.ctrlKey)) {
        // cmd + k + shift, toggle echo eval output
        if (e.shiftKey) {
          csc.echoEvalOutput = !csc.echoEvalOutput;
        } else {
          window.clear();
        }
      }
    });

    if (store) {
      window.echoEvalOutput(store.get('echoEvalOutput'));
    }
  });
  </script>
</head>
<body>
  <div id="main">
    <textarea id="consoleInput" class="consoleTypo" autofocus="autofocus">usage() # press enter</textarea>
    <div id="consoleOutput"></div>
    <div id="consoleDashboard">
    </div>
  </div>
</body>
</head>
